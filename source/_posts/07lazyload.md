---
title: 懒加载与预加载
date: 2018-03-01 16:32:49
tags: 
- html 
- javascipt
- jquery
categories:
- 前端 
---

懒加载和预加载是开发中常用的设计模式，实现方式也有很多，在项目中我使用了懒加载，在这里简单记录一下。

<!-- more -->
# 1.懒加载
### 1.1什么是懒加载？
>懒加载通俗的讲就是延迟加载。图片懒加载就是当页面滚动到可视区域时，图片才显示出来。

### 1.2.懒加载的原理。
>页面中的img，如果没有src属性，浏览器就不会去下载图片。把页面中所有的图片路径都设置为空（或者用一个小的图片代替（1px*1px）），当滚动到可视区域的时候才设置图片正确的路径。图片真正的路径用自定义属性保存，比如data-src.

### 1.3.为什么要使用懒加载，懒加载的优点？
>比如商城网站，有很多内容和图片，数量多而且比较大，如果页面一次性加载的话，有时候会等很久。
>优点：页面加载速度快、可以减轻服务器的压力、节约了流量,用户体验好。目的是作为服务器前端的优化，减少请求数或延迟请求数。

### 1.4.懒加载的实现步骤
>（1）将img的src=""
>（2）为img添加data-src="图片真正路径"
>（3）当触发某些条件时，自动改变该区域的图片的src属性为真实的地址 
![](./src.jpg "设置图片路径")
```
img = $('img');
// 页面刷新时首先调用一次加载函数
lazyload();
// 注册滚动监听函数
$(window).scroll(lazyload);
//懒加载函数
function lazyload(){
   for(var i=0;i<img.length;i++){
        //当前图片相对于页面顶部的距离  <= 可视区域 + 滚动条距离距离顶部的距离 -400。
        if(img.eq(i).offset().top < parseInt($(window).height()) + parseInt($(window).scrollTop())-400) {
        // 如果每个img的src为空的话，给每个img的src赋值为data-src的值
           if(img.eq(i).attr("src") == "") {
               var src = img.eq(i).attr("data-src");
               img.eq(i).attr("src", src);
               n = i + 1;
            }
        }
    }
}
```
### 1.5懒加载的实现方式
>1.定时器延迟加载
>2.符合某些条件才加载
>3.可视区加载，距用户看到某个图片一定距离时开始加载，保证用户下拉时可以看到图片，监控滚动条来实现。

# 2.预加载
### 2.1什么是预加载？
>提前加载图片，当用户需要查看时可直接从本地缓存中渲染。

### 2.2为什么要使用预加载，预加载的优点？
>图片预先加载到浏览器中，访问者便可顺利地在你的网站上冲浪，并享受到极快的加载速度。这对图片画廊及图片占据很大比例的网站来说十分有利，它保证了图片快速、无缝地发布，也可帮助用户在浏览你网站内容时获得更好的用户体验。
>优点：牺牲服务器前端性能，换取更好的用户体验，这样可以使用户的操作得到最快的反映。

### 2.3预加载的实现方式
>new Image();
>http://web.jobbole.com/86785/



